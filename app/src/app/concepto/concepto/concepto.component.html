<div *ngIf="currentConcepto$ | async as data" class="concepto-container">
  <h1 *ngIf="data.ID">
    Modificar concepto <span>{{data.concepto}}</span>
  </h1>
  <h1 *ngIf="!data.ID">
    Nuevo concepto
  </h1>

  <mat-divider></mat-divider>

  <div mat-dialog-content class="content" id="contentTOPDF">
    <mat-accordion>
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Datos Básicos</mat-panel-title>
        </mat-expansion-panel-header>

        <div>
          <mat-form-field class="standard-input"><input [disabled]=isDefault(data)
            matInput required [(ngModel)]="data.nombre" placeholder="Nombre" type="text" autocomplete="off">
          </mat-form-field>
          <mat-form-field class="standard-input"><input [disabled]=isDefault(data) 
            matInput [(ngModel)]="data.codigo" placeholder="Código" type="text" autocomplete="off">
          </mat-form-field>
        </div>
        <div>
          <app-selector-default nombre="cuenta" [disabled]=isDefault(data) required=true [(matSelect)]="data.cuentacontableid"
          (optionSelected)="data.cuentacontableid=$event.ID"></app-selector-default>
          <app-selector-default nombre="tipoconcepto" [disabled]=isDefault(data) required=true [(matSelect)]="data.tipoconceptoid"
          (optionSelected)="data.tipoconceptoid=$event.ID;data.tipoconcepto=$event"></app-selector-default>
        </div>
        <div>
          <mat-form-field class="standard-input">
            <input [disabled]=isDefault(data) matInput [(ngModel)]="data.descripcion" placeholder="Descripción" type="text" autocomplete="off">
          </mat-form-field>
        </div>
        <div style="margin: 15px 0px;">
          <mat-checkbox [disabled]=isDefault(data) color="primary" class="example-margin"  [(ngModel)]="data.esnovedad">Es Novedad</mat-checkbox>
        </div>
        <div style="margin: 15px 0px;">
          <mat-checkbox [disabled]=isDefault(data) color="primary" class="example-margin"  [(ngModel)]="data.esimprimible">Es Imprimible</mat-checkbox>
        </div>

      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Cálculo Automático</mat-panel-title>
        </mat-expansion-panel-header>
        
        <mat-radio-group [color]="'primary'" [(ngModel)]="selectedGroupAutomaticCalculation" (ngModelChange)="onAutomaticCalcGroupSelected()">
          
          <div class="columns">
            <div class="column is-2">
              <mat-radio-button class="example-radio-button" [value]="'percentage'">
                Porcentajes
              </mat-radio-button>
            </div>
            <div class="column">
              <mat-form-field class="standard-input" style="width: 100px;">
                <input [disabled]="isDefault(data) || selectedGroupAutomaticCalculation !== 'percentage'" matInput [(ngModel)]="data.porcentaje" placeholder="Porcentaje" type="number" autocomplete="off">
              </mat-form-field>
              <span style="margin: 0px 10px; color: #808080;">Aplicable sobre </span>
              <app-selector-default nombre="tipodecalculo" [disabled]="isDefault(data) || selectedGroupAutomaticCalculation !== 'percentage'" required=false [(matSelect)]="data.tipodecalculoid"
                (optionSelected)="data.tipodecalculoid=$event.ID; data.tipoconcepto.codigo=$event.codigo">
              </app-selector-default> 
            </div>
          </div>

          <mat-divider></mat-divider>

          <div class="columns">
            <div class="column is-2">
              <mat-radio-button class="example-radio-button" [value]="'formulas'">
                Fórmulas
              </mat-radio-button>
            </div>
            <div class="column">
              <mat-form-field class="selector">
                <mat-label>Seleccionar Fórmula</mat-label>
                <mat-select [(ngModel)]="selectedFormula" (ngModelChange)="onFormulaSelected()" name="formula" [disabled]="selectedGroupAutomaticCalculation !== 'formulas'">
                  <mat-option *ngFor="let formula of availableFormulas" [value]="formula">
                    {{ formula.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
<!--               
              <div class="columns" *ngIf="selectedFormula">
                <div class="column is-3">
                  <mat-form-field>
                    <mat-label>Período desde</mat-label>
                    <input matInput [matDatepicker]="fromDatePicker" [value]="formulaFromDate" readonly required>
                    <mat-datepicker-toggle matSuffix [for]="fromDatePicker"></mat-datepicker-toggle>
                    <mat-datepicker #fromDatePicker></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="column is-3">
                  <mat-form-field>
                    <mat-label>Período hasta</mat-label>
                    <input matInput [matDatepicker]="toDatePicker" [value]="toDatePicker" readonly required>
                    <mat-datepicker-toggle matSuffix [for]="toDatePicker"></mat-datepicker-toggle>
                    <mat-datepicker #toDatePicker></mat-datepicker>
                  </mat-form-field>
                </div>
              </div>
               -->
            </div>

            <mat-divider></mat-divider>

          </div>
          
          <mat-divider></mat-divider>

          <div class="columns">
            <div class="column is-2">
              <mat-radio-button class="example-radio-button" [value]="'noaplica'">
                No Aplica
              </mat-radio-button>
            </div>
          </div>

          </mat-radio-group>         
       
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Impuesto a las Ganancias</mat-panel-title>
        </mat-expansion-panel-header>
        <div>
          <app-selector-default #tipoimpuestosganancias nombre="tipoimpuestosganancias" [filter]="getFilterTipoimpuestosganancias(data)" [(matSelect)]="data.tipoimpuestogananciasid"
          (optionSelected)="data.tipoimpuestogananciasid=$event.ID" (change)="changeHandler(data, tipoimpuestosganancias)" [disabled]=isDefault(data)></app-selector-default> 
          <div *ngIf="data && data.tipoconcepto && data.tipoconcepto.codigo != 'RETENCION'">
            <app-selector-default type="hardcode" nombre="si/no" [(matSelect)]="data.prorrateo" (optionSelected)="data.prorrateo=$event.nombre.toLowerCase() == 'si'" placeholder="Prorrateo" autocomplete="off" [required]="data.tipoimpuestogananciasid != null" [disabled]=isDefault(data)></app-selector-default>
            <app-selector-default type="hardcode" nombre="si/no" [(matSelect)]="data.basesac" (optionSelected)="data.basesac=$event.nombre.toLowerCase() == 'si'" placeholder="Base del SAC" autocomplete="off" [required]="data.tipoimpuestogananciasid != null" [disabled]=isDefault(data)></app-selector-default>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <div mat-dialog-actions class="actions">
    <button mat-raised-button color="primary" mat-button *ngIf=!isDefault(data)
      (click)="onClickSave(data)">Guardar</button>
    <button mat-raised-button mat-button color="secondary" (click)="onClickAbort()">Cerrar</button>
    <button *ngIf=isNew(data) mat-raised-button color="secondary" mat-button
      (click)="printService.printTOPDF()">Imprimir</button>
  </div>
</div>